# ğŸ“˜ SemanticLayerBuilder

SemanticLayerBuilder is an **LLM-native system** for automatically generating a clean, validated **semantic layer** (dimensions + metrics) for arbitrary client datasets.  
It enables consultants to onboard new clients quickly by turning raw data (XML or SQL) into standardized YAML files that conform to a **generic semantic contract** used by an MCP (Model Context Protocol) semantic server.

The system consists of:

- A **Frontend UI** (single-screen)  
- A **FastAPI backend**  
- A **Builder Agent** (LLM worker using `builder_agent_system.md`)  
- An **MCP Semantic Server** that loads and serves the generated semantic layer

---

## ğŸš€ High-Level Data Flow

    User â†’ Frontend UI â†’ FastAPI Backend â†’ Builder Agent (LLM)
          â†“                                    â†“
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ YAML OUT â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             dimensions.yaml
                             metrics.yaml

    MCP Server loads YAML â†’ exposes semantic querying tools  
    Chatbots/Agents â†’ call MCP server to run metric queries  

---

## ğŸ“‚ Repository Structure

    SemanticLayerBuilder/
    â”‚
    â”œâ”€â”€ docs/
    â”‚   â”œâ”€â”€ project_definition.md
    â”‚   â”œâ”€â”€ builder_agent.md
    â”‚   â””â”€â”€ builder_agent_runbook.md
    â”‚
    â”œâ”€â”€ prompts/
    â”‚   â””â”€â”€ builder_agent_system.md
    â”‚
    â”œâ”€â”€ backend/
    â”‚   â”œâ”€â”€ main.py
    â”‚   â”œâ”€â”€ routes/
    â”‚   â”œâ”€â”€ services/
    â”‚   â””â”€â”€ models/
    â”‚
    â”œâ”€â”€ frontend/
    â”‚
    â”œâ”€â”€ semantic_output/
    â”‚   â”œâ”€â”€ dimensions.yaml
    â”‚   â””â”€â”€ metrics.yaml
    â”‚
    â”œâ”€â”€ tests/
    â”‚
    â””â”€â”€ README.md

---

## ğŸ§  Key Concepts

### 1. Semantic Layer

Represents client data as:

- **Dimensions** (categorical, time, numeric, boolean)  
- **Metrics** (sum/avg/count/min/max)

Emitted as YAML and validated against a **generic semantic contract**.

---

### 2. Builder Agent (LLM Worker)

The Builder Agent:

- Receives schema, sample rows, and user hints  
- Infers dimensions and metrics  
- Produces strict, deterministic YAML  
- Never executes SQL  
- Must follow the rules defined in:
  - `docs/builder_agent.md`
  - `prompts/builder_agent_system.md`

---

### 3. Generic Semantic Contract

Defined in `docs/project_definition.md`, specifies:

- Allowed dimension types  
- Allowed metric aggregations  
- Exact YAML shapes  
- Required MCP server interface  

Every clientâ€™s YAML must conform to this contract.

---

### 4. MCP Semantic Server

Loads YAML generated by the Builder Agent and provides:

- `list_dimensions`  
- `list_metrics`  
- `get_metric_definition`  
- `run_metric_query`  
- `explain_metric`  

This powers downstream chatbots and analytics agents.

---

## ğŸ› ï¸ Development Workflow

1. Frontend collects configuration (source, sample size, exclusions).  
2. Backend:
   - Connects to DB or XML
   - Samples rows
   - Constructs the Builder Agent payload
   - Loads `prompts/builder_agent_system.md`
   - Calls the LLM  
3. Builder Agent returns:
   - `dimensions_yaml`
   - `metrics_yaml`
   - `validation_status`
   - `notes` / `errors`  
4. Backend writes YAML to `semantic_output/`.  
5. MCP Server loads YAML for runtime querying.

---

## ğŸ¤ Contributing

Start here:

1. `docs/project_definition.md` â€” system architecture  
2. `docs/builder_agent.md` â€” Builder Agent behavior  
3. `prompts/builder_agent_system.md` â€” actual LLM instructions  

---

## ğŸ§­ Future Enhancements

- Multi-table join inference  
- Additional metric types  
- Time-series transformations  
- Schema profiling  
- MCP extensions (joins, window functions)

---

## ğŸ“„ License

TBD (MIT recommended)